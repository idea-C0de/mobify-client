{>"/base/lib/base_konf.konf"/}
{<tmpl}{/tmpl}
{<data} {

'OUTPUTHTML': function(context) {
	context.data('$html').find('iframe, img, script').remove();

	function validate() {
		var report = function(msg) {
			var url = 'http://' + location.hostname + ':1343/endTest';
			if (msg) url = url + '?msg=' + encodeURIComponent(msg);
			location.href = url;
			report = function(){};
		}
		
		try {
			var request = new XMLHttpRequest();  
			request.open('GET', '/listRequests', false);  
			request.send();
	
			(request.responseText.split('\n').length == 1) || report("resource leak")
			
		} catch (ex) {
			report('unexpected exception')
		}
		report();
	}

    return context.data('$html').prop('outerHTML') + '<script>(' + validate.toString() + ')();</scr' + 'ipt>'
}

} {/data}